!function(a,b){"object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=b()),"function"==typeof define&&define.amd&&define(["terraformer/terraformer"],b),"object"==typeof a.navigator&&("undefined"==typeof a.Terraformer&&(a.Terraformer={}),a.Terraformer.ArcGIS=b())}(this,function(){function a(a){var b,c=0,d=0,e=a.length,f=a[d];for(d;e-1>d;d++)b=a[d+1],c+=(b[0]-f[0])*(b[1]+f[1]),f=b;return c>=0}function b(b){var c=[],d=b.shift();a(d)||d.reverse(),c.push(d);for(var e=0;e<b.length;e++){var f=b[e];a(f)&&d.reverse(),c.push(b[e])}return c}function c(a){for(var c=[],d=0;d<a.length;d++){for(var e=b(a[d]),f=e.length-1;f>=0;f--){var g=e[f];c.push(g)}c.push()}return c}function d(a,b){var c=h.Tools.arrayIntersectsArray(a,b),d=h.Tools.coordinatesContainPoint(a,b[0]);return!c&&d?!0:!1}function e(b){for(var c=[],e=[],f=0;f<b.length;f++){var g=b[f];if(a(g)){var h=[g];c.push(h)}else e.push(g)}for(;e.length;){for(var i=e.pop(),j=!1,k=c.length-1;k>=0;k--){var l=c[k][0];if(d(l,i)){c[k].push(i),j=!0;break}}j||c.push([i.reverse()])}return 1===c.length?{type:"Polygon",coordinates:c[0]}:{type:"MultiPolygon",coordinates:c}}function f(a){var b=JSON.parse(JSON.stringify(a)),c={};b.x&&b.y&&(c.type="Point",c.coordinates=[b.x,b.y]),b.points&&(c.type="MultiPoint",c.coordinates=b.points),b.paths&&(1===b.paths.length?(c.type="LineString",c.coordinates=b.paths[0]):(c.type="MultiLineString",c.coordinates=b.paths)),b.rings&&(c=e(b.rings)),b.geometry&&(c.type="Feature",c.geometry=f(b.geometry),c.properties=b.attributes||{});var d=b.geometry?b.geometry.spatialReference:b.spatialReference;return d&&102100===d.wkid&&(c=h.toGeographic(c)),new h.Primitive(c)}function g(a){var d,e=JSON.parse(JSON.stringify(a)),f={wkid:4326},h={};switch(e.type){case"Point":h.x=e.coordinates[0],h.y=e.coordinates[1],h.spatialReference=f;break;case"MultiPoint":h.points=e.coordinates,h.spatialReference=f;break;case"LineString":h.paths=[e.coordinates],h.spatialReference=f;break;case"MultiLineString":h.paths=e.coordinates,h.spatialReference=f;break;case"Polygon":h.rings=b(e.coordinates),h.spatialReference=f;break;case"MultiPolygon":h.rings=c(e.coordinates),h.spatialReference=f;break;case"Feature":h.geometry=g(e.geometry),h.attributes=e.properties;break;case"FeatureCollection":for(h=[],d=0;d<e.features.length;d++)h.push(g(e.features[d]));break;case"GeometryCollection":for(h=[],d=0;d<e.geometries.length;d++)h.push(g(e.geometries[d]))}return h}var h,i={};return"object"==typeof this.navigator&&(h=this.Terraformer),"object"==typeof module&&"object"==typeof module.exports&&(h=require("terraformer")),arguments[0]&&"function"==typeof define&&define.amd&&(h=arguments[0]),i.parse=f,i.convert=g,i});